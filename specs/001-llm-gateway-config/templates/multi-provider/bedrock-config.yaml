# AWS Bedrock Provider Configuration
# Purpose: Claude models via AWS Bedrock with multi-region support
# Usage: litellm --config bedrock-config.yaml --port 4000
# User Story: US3 - Multi-Provider Gateway Configuration (Priority: P3)
# Provider: AWS Bedrock

model_list:
  # === Claude 3.5 Sonnet (Primary) ===
  # Latest model with enhanced performance and extended context

  - model_name: claude-3-5-sonnet
    litellm_params:
      model: bedrock/anthropic.claude-3-5-sonnet-20241022-v2:0
      aws_region_name: os.environ/AWS_REGION
      # aws_access_key_id: os.environ/AWS_ACCESS_KEY_ID          # Optional if using IAM role
      # aws_secret_access_key: os.environ/AWS_SECRET_ACCESS_KEY  # Optional if using IAM role
    model_info:
      mode: chat
      supports_function_calling: true
      supports_vision: true
      max_tokens: 8192
      max_input_tokens: 200000
    rpm: 50
    tpm: 2000000

  # === Claude 3 Opus (Highest Capability) ===
  # Most capable model for complex reasoning tasks

  - model_name: claude-3-opus
    litellm_params:
      model: bedrock/anthropic.claude-3-opus-20240229-v1:0
      aws_region_name: os.environ/AWS_REGION
    model_info:
      mode: chat
      supports_function_calling: true
      supports_vision: true
      max_tokens: 4096
      max_input_tokens: 200000
    rpm: 30
    tpm: 1500000

  # === Claude 3 Sonnet (Balanced) ===
  # Balance between performance and cost

  - model_name: claude-3-sonnet
    litellm_params:
      model: bedrock/anthropic.claude-3-sonnet-20240229-v1:0
      aws_region_name: os.environ/AWS_REGION
    model_info:
      mode: chat
      supports_function_calling: true
      supports_vision: true
      max_tokens: 4096
      max_input_tokens: 200000
    rpm: 60
    tpm: 2000000

  # === Claude 3 Haiku (Fast & Cost-Effective) ===
  # Fastest model for high-volume, low-latency use cases

  - model_name: claude-3-haiku
    litellm_params:
      model: bedrock/anthropic.claude-3-haiku-20240307-v1:0
      aws_region_name: os.environ/AWS_REGION
    model_info:
      mode: chat
      supports_function_calling: true
      supports_vision: true
      max_tokens: 4096
      max_input_tokens: 200000
    rpm: 100
    tpm: 3000000

# Multi-Region Configuration (High Availability)
# Uncomment to enable automatic failover across AWS regions
#
# - model_name: claude-3-5-sonnet-us-west-2
#   litellm_params:
#     model: bedrock/anthropic.claude-3-5-sonnet-20241022-v2:0
#     aws_region_name: us-west-2
#   rpm: 50
#   tpm: 2000000
#
# - model_name: claude-3-5-sonnet-eu-west-1
#   litellm_params:
#     model: bedrock/anthropic.claude-3-5-sonnet-20241022-v2:0
#     aws_region_name: eu-west-1
#   rpm: 50
#   tpm: 2000000

# LiteLLM Settings
litellm_settings:
  # Drop unsupported parameters gracefully
  drop_params: true

  # Enable debug logging for troubleshooting (set to false in production)
  set_verbose: false

  # Global timeout and retries
  num_retries: 3
  timeout: 30

  # Request logging (optional - requires database)
  # success_callback: ["langfuse"]
  # failure_callback: ["langfuse"]

# Router Settings
router_settings:
  # Routing strategy
  routing_strategy: least-busy # Options: simple-shuffle, least-busy, usage-based-routing

  # Retry policy
  retry_policy:
    TimeoutErrorRetries: 2
    RateLimitErrorRetries: 3
    InternalServerErrorRetries: 2

  # Fallback configuration
  allowed_fails: 3 # Number of failures before marking model unhealthy
  cooldown_time: 60 # Seconds before retrying failed model

# General Settings
general_settings:
  # API Configuration
  master_key: os.environ/LITELLM_MASTER_KEY # Required for proxy authentication

  # Enable Admin UI
  ui: true

  # Set port
  port: 4000
# AWS Authentication Methods:
#
# Method 1: IAM Role (Recommended for EC2/ECS/Lambda)
#   - No explicit credentials needed
#   - Automatic credential rotation
#   - Least privilege via IAM policies
#
# Method 2: Environment Variables
#   export AWS_ACCESS_KEY_ID="<access-key>"
#   export AWS_SECRET_ACCESS_KEY="<secret-key>"
#   export AWS_SESSION_TOKEN="<session-token>"  # Optional for temporary credentials
#   export AWS_REGION="us-east-1"
#
# Method 3: AWS Credentials File (~/.aws/credentials)
#   [default]
#   aws_access_key_id = <access-key>
#   aws_secret_access_key = <secret-key>
#   region = us-east-1

# Required IAM Permissions:
#
# {
#   "Version": "2012-10-17",
#   "Statement": [
#     {
#       "Effect": "Allow",
#       "Action": [
#         "bedrock:InvokeModel",
#         "bedrock:InvokeModelWithResponseStream"
#       ],
#       "Resource": [
#         "arn:aws:bedrock:*:*:inference-profile/anthropic.claude-*"
#       ]
#     }
#   ]
# }

# Claude Code Integration:
#
# 1. Set Claude Code environment variables:
#    export ANTHROPIC_BASE_URL="http://localhost:4000"
#    export ANTHROPIC_API_KEY="<litellm-master-key>"
#    export CLAUDE_CODE_SKIP_BEDROCK_AUTH=1  # Optional: Skip Claude Code's Bedrock auth
#
# 2. Or add to ~/.claude/settings.json:
#    {
#      "anthropicBaseUrl": "http://localhost:4000",
#      "anthropicAuthToken": "<litellm-master-key>"
#    }
#
# 3. Verify with: claude /status
#
# See examples/us3-provider-env-vars.md for complete environment variable reference

# Available Bedrock Regions:
# - us-east-1 (US East, N. Virginia)
# - us-west-2 (US West, Oregon)
# - eu-west-1 (Europe, Ireland)
# - eu-west-3 (Europe, Paris)
# - ap-northeast-1 (Asia Pacific, Tokyo)
# - ap-southeast-1 (Asia Pacific, Singapore)
# - ap-southeast-2 (Asia Pacific, Sydney)
#
# Note: Model availability varies by region. Check AWS Bedrock documentation for current status.

# Troubleshooting:
# - Authentication errors: Verify AWS credentials with `aws sts get-caller-identity`
# - Region errors: Ensure model is available in target region
# - Rate limiting: Check AWS quotas in Service Quotas console
# - Connection errors: Verify network connectivity to bedrock.*.amazonaws.com
#
# See examples/us3-multi-provider-setup.md for detailed troubleshooting guide
